<!--
@license
Copyright (c) 2015 The ExpandJS authors. All rights reserved.
This code may only be used under the BSD style license found at https://expandjs.github.io/LICENSE.txt
The complete set of authors may be found at https://expandjs.github.io/AUTHORS.txt
The complete set of contributors may be found at https://expandjs.github.io/CONTRIBUTORS.txt
-->

<!--
This element is used to wrap a material demo.

@element mat-demo
@description A custom element used to display a Material Design demo page
@keywords material design, material demo, web app, html5, expandjs, web-components
@group containers
@homepage http://expandjs.com/elements/mat-demo

@dependency polymer Polymer/polymer#^1.0.0
@dependency expandjs ExpandJS/expandjs#0.9.3
@dependency iron-flex-layout PolymerElements/iron-flex-layout#^1.0.0
@dependency mat-content ExpandJS/mat-content#0.9.3
@dependency mat-icon-button ExpandJS/mat-icon-button#0.9.3
@dependency mat-icons ExpandJS/mat-icons#0.9.3
@dependency mat-paper ExpandJS/mat-paper#0.9.3
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../expandjs/expandjs.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../mat-content/mat-content.html">
<link rel="import" href="../mat-icon-button/mat-icon-button.html">
<link rel="import" href="../mat-icons/image-icons.html">
<link rel="import" href="../mat-panel/mat-panel.html">

<dom-module id="mat-demo">

    <style>
        :host {
            display: block;
            margin: 16px;
            max-width: 720px;
            overflow: visible;
        }

        :host #matDemoLabel {
            @apply(--layout-flex);
            padding-left: 12px;
        }

        :host #matDemoCode::shadow pre {
            margin: 0;
        }

        :host #matDemoBody {
            position: relative;
        }

        :host([padding-disabled]) #matDemoBody {
            padding: 0;
        }

        /* TABLET */

        @media (min-width: 960px) {

            :host {
                margin: 24px;
            }
        }
    </style>

    <template>
        <mat-panel id="matDemoPanel" raised>
            <mat-toolbar id="matDemoHeader" background="[[toolbarColor]]">
                <div id="matDemoLabel">{{label}}</div>
                <mat-icon-button id="matDemoCodeToggle" icon="action:code" on-xp-activate="toggleCode"></mat-icon-button>
                <mat-icon-button id="matDemoThemeToggle" active="[[_computeActive(theme)]]" active-icon="image:brightness-3" icon="image:brightness-5" on-xp-activate="toggleTheme"></mat-icon-button>
            </mat-toolbar>
            <xp-collapse id="matDemoCodeCollapse" collapsed>
                <xp-markdown id="matDemoCode" code="[[code]]"></xp-markdown>
            </xp-collapse>
            <mat-paper id="matDemoMain" theme="{{theme}}">
                <mat-content id="matDemoBody">
                    <content id="content"></content>
                </mat-content>
            </mat-paper>
        </mat-panel>
    </template>

    <script>
        Polymer({

            // ELEMENT
            is: 'mat-demo',

            /*********************************************************************/

            /**
             * Toggles the code.
             *
             * @method toggleCode
             * @return {Element}
             */
            toggleCode: function () {
                var self = this;
                self.$.matDemoCodeCollapse.toggle();
                return self;
            },

            /**
             * Toggles the theme.
             *
             * @method toggleTheme
             * @return {Element}
             */
            toggleTheme: function () {
                var self = this;
                self.theme = self.$.matDemoMain.foreground;
                return self;
            },

            /*********************************************************************/

            // PROPERTIES
            properties: {

                /**
                 * The demo's code.
                 *
                 * @attribute code
                 * @type string
                 * @notifies
                 * @readonly
                 */
                code: {
                    notify: true,
                    readOnly: true,
                    type: String,
                    value: null
                },

                /**
                 * The demo's label.
                 *
                 * @attribute label
                 * @type string
                 */
                label: {
                    reflectToAttribute: true,
                    type: String,
                    value: null
                },

                /**
                 * If set to true, the content's padding is disabled.
                 *
                 * @attribute padding-disabled
                 * @type boolean
                 * @default false
                 */
                paddingDisabled: {
                    reflectToAttribute: true,
                    type: Boolean,
                    value: false
                },

                /**
                 * The paper's theme, used to apply the default foreground color.
                 *
                 * @attribute theme
                 * @type string
                 * @notifies
                 */
                theme: {
                    notify: true,
                    type: String
                },

                /**
                 * The toolbar's background color.
                 *
                 * @attribute toolbar-color
                 * @type string
                 * @default "indigo"
                 */
                toolbarColor: {
                    reflectToAttribute: true,
                    type: String,
                    value: 'indigo'
                }
            },

            /*********************************************************************/

            // COMPUTER
            _computeActive: function (theme) {
                return theme === 'dark';
            },

            /*********************************************************************/

            // LISTENER
            ready: function () {

                // Vars
                var self   = this,
                    script = XP.getDistributedElement(Polymer.dom(self.$.content), 'script[type="text/html"]'),
                    lines  = script ? script.innerHTML.split('\n') : [],
                    first  = lines.shift(),
                    last   = lines.pop(),
                    spaces = XP.match(lines[0] || '', /^[ ]+/)[0] || '';

                // Cleaning
                lines.forEach(function (line, i) { lines[i] = line.replace(spaces, ''); });

                // Setting
                self._setCode('```html\n' + lines.join('\n') + '\n```');
            }
        });
    </script>

</dom-module>